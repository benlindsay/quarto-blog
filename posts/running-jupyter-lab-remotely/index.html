<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.269">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Ben Lindsay">
<meta name="dcterms.date" content="2018-04-30">
<meta name="description" content="I have a research cluster where I do most of my analyses for my PhD work, and running Jupyter Lab directly on the cluster means I don’t have to copy files between the cluster and my desktop.">

<title>Shallow Learnings - Running Jupyter Lab Remotely</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Shallow Learnings</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html">
 <span class="menu-text">About Me</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://data-folks.masto.host/@benlindsay"><i class="bi bi-mastodon" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/benlindsay"><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://linkedin.com/in/benjlindsay"><i class="bi bi-linkedin" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Running Jupyter Lab Remotely</h1>
  <div class="quarto-categories">
    <div class="quarto-category">bash</div>
    <div class="quarto-category">jupyter</div>
    <div class="quarto-category">tmux</div>
    <div class="quarto-category">ssh</div>
    <div class="quarto-category">productivity</div>
  </div>
  </div>

<div>
  <div class="description">
    I have a research cluster where I do most of my analyses for my PhD work, and running Jupyter Lab directly on the cluster means I don’t have to copy files between the cluster and my desktop.
  </div>
</div>


<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Ben Lindsay </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">April 30, 2018</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<p><em><strong>Updated Sept.&nbsp;19, 2019:</strong> Added separate instructions for running on a compute node</em></p>
<p>I’m a huge fan of <a href="http://jupyter.org/">Jupyter Notebooks</a>, and I was very excited when I found out about Jupyter Lab, which provides a much more comprehensive user experience around Jupyter Notebooks. <a href="https://towardsdatascience.com/jupyter-notebooks-are-breathtakingly-featureless-use-jupyter-lab-be858a67b59d">Other</a> <a href="https://blog.jupyter.org/jupyterlab-is-ready-for-users-5a6f039b8906">posts</a> have covered in more detail why we should switch to using Jupyter Lab instead, so I won’t talk about that here.</p>
<p>Instead, I just want to share how to run Jupyter Lab efficiently on a remote machine. I have a research cluster where I do most of my analyses for my PhD work, and running Jupyter Lab directly on the cluster means I don’t have to copy files between the cluster and my desktop.</p>
<p>Before we begin, one thing to keep in mind about research clusters, i.e.&nbsp;High Performance Computing (HPC) clusters, is the concept of a login node vs a compute node. When you <code>ssh</code> into your cluster, you are immediately in a login node, which is where you do all your main file editing and manipulation. These nodes usually don’t have the memory required for intense compute jobs, which is where the compute nodes come in. You typically submit jobs via job schedulers like SLURM or PBS to those compute nodes.</p>
<p>With that in mind, this post will be split into information for running Jupyter Lab on 1) a login node, and 2) a compute node. You should ask your system administrator which they would prefer.</p>
<p><strong>Contents</strong>: - <a href="#running-on-a-login-node">Running on a login node</a> - <a href="#commands">Commands</a> - <a href="#simplfying-the-remote-side">Simplfying the remote side</a> - <a href="#simplfying-the-local-side">Simplfying the local side</a> - <a href="#putting-it-all-together">Putting it all together</a> - <a href="#running-on-a-compute-node">Running on a compute node</a> - <a href="#commands-1">Commands</a> - <a href="#simplfying-the-remote-side-1">Simplfying the remote side</a> - <a href="#simplfying-the-local-side-1">Simplfying the local side</a> - <a href="#putting-it-all-together-1">Putting it all together</a></p>
<section id="running-on-a-login-node" class="level1">
<h1>Running on a login node</h1>
<section id="commands" class="level2">
<h2 class="anchored" data-anchor-id="commands">Commands</h2>
<p>To run Jupyter Lab on a login node, you need to open 2 terminal windows. In the first window:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> ssh username@hostname</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> jupyter lab <span class="at">--no-browser</span> <span class="at">--port</span><span class="op">=</span>5678</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="ex">...</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="ex">[I</span> 10:17:14.160 LabApp] Use Control-C to stop this server and shut down all kernels <span class="er">(</span><span class="ex">twice</span> to skip confirmation<span class="kw">)</span><span class="bu">.</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="ex">[C</span> 10:17:14.160 LabApp]</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    <span class="ex">Copy/paste</span> this URL into your browser when you connect for the first time,</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    <span class="ex">to</span> login with a token:</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>        <span class="ex">http://localhost:5678/?token=XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Note that the default port for Jupyter is <code>8888</code>, but to be courteous to other potential users of this cluster, you should choose an arbitrary 4-digit number (I arbitrarily chose 5678 in this case) to leave <code>8888</code> available in case someone else is playing with Jupyter.</p>
<p>Then in the second window:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> ssh <span class="at">-CNL</span> localhost:5678:localhost:5678 username@hostname</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Then in your web browser of choice, navigate to</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="ex">localhost:5678</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>in the url bar. A login screen will show up asking for a token. Scroll down and you’ll see an option to set up a password:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="jupyter-setup-password.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Jupyter Password Setup</figcaption><p></p>
</figure>
</div>
<p>Enter the token (i.e.&nbsp;<code>XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</code> from above) and your desired password, and from now on you can just use your password to login.</p>
<p>All that is kind of a lot just to open up Jupyter Lab. So I found ways to significantly simplify the process from both the remote and local side.</p>
</section>
<section id="simplfying-the-remote-side" class="level2">
<h2 class="anchored" data-anchor-id="simplfying-the-remote-side">Simplfying the remote side</h2>
<p>To make things easier on the remote machine side of things, <code>tmux</code> (or <code>screen</code>) and bash aliases and functions really come in handy. I like to have a Jupyter Lab session running constantly in my remote machine whether I’m logged in or not. Then I can ssh tunnel in to the existing session whenever I want! To do this, I do the following:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> ssh username@hostname</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> tmux</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> opens persistent shell <span class="er">session</span> <span class="ex">]</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> jlremote</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="ex">...</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="ex">[I</span> 10:17:14.160 LabApp] Use Control-C to stop this server and shut down all kernels <span class="er">(</span><span class="ex">twice</span> to skip confirmation<span class="kw">)</span><span class="bu">.</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="ex">[C</span> 10:17:14.160 LabApp]</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    <span class="ex">Copy/paste</span> this URL into your browser when you connect for the first time,</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>    <span class="ex">to</span> login with a token:</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>        <span class="ex">http://localhost:8888/?token=XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>I have <code>jlremote</code> defined as an alias in my remote <code>~/.bashrc</code> file like so:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="bu">alias</span> jlremote=<span class="st">'jupyter lab --no-browser --port=5678'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>So once I have that Jupyter Lab session running, I can detach from the tmux session with <code>CTRL-b, d</code> (or <code>CTRL-a, CTRL-d</code> if you used the <code>screen</code> command), and let that process run indefinitely (days, weeks, months…).</p>
<p>Now let’s deal with the local stuff.</p>
</section>
<section id="simplfying-the-local-side" class="level2">
<h2 class="anchored" data-anchor-id="simplfying-the-local-side">Simplfying the local side</h2>
<p>On the local side, I wanted to be able to run a single command like <code>jllocal</code> to open Jupyter Lab, so I wrote a bash function that goes in my local <code>~/.bashrc</code> file. If you use this make sure to edit all the all-caps stuff, like <code>USERNAME</code> and <code>HOSTNAME</code>.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span><span class="fu"> jllocal</span> <span class="kw">{</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="va">port</span><span class="op">=</span>5678 </span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="va">remote_username</span><span class="op">=</span>USERNAME</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="va">remote_hostname</span><span class="op">=</span>HOSTNAME</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="va">url</span><span class="op">=</span><span class="st">"http://localhost:</span><span class="va">$port</span><span class="st">"</span> </span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="bu">echo</span> <span class="st">"Opening </span><span class="va">$url</span><span class="st">"</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  <span class="ex">open</span> <span class="st">"</span><span class="va">$url</span><span class="st">"</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  <span class="va">cmd</span><span class="op">=</span><span class="st">"ssh -CNL localhost:"</span><span class="va">$port</span><span class="st">":localhost:"</span><span class="va">$port</span><span class="st">" </span><span class="va">$remote_username</span><span class="st">@</span><span class="va">$remote_hostname</span><span class="st">"</span> </span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>  <span class="bu">echo</span> <span class="st">"Running '</span><span class="va">$cmd</span><span class="st">'"</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>  <span class="bu">eval</span> <span class="st">"</span><span class="va">$cmd</span><span class="st">"</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This function does a few things when you type <code>jllocal</code>:</p>
<ol type="1">
<li>Runs ssh tunneling command if it’s not already running</li>
<li>Grabs the Jupyter token from the remote machine</li>
<li>Opens a tab in your browser with the right url and token for you</li>
</ol>
<p>When you’re done accessing your Jupyter Lab session, type <code>CTRL-C</code> and it will shut down the ssh tunnel.</p>
</section>
<section id="putting-it-all-together" class="level2">
<h2 class="anchored" data-anchor-id="putting-it-all-together">Putting it all together</h2>
<p>So with an alias in place in your remote <code>~/.bashrc</code>, a persistent remote tmux/screen session running Jupyter Lab, and a function defined in your local <code>~/.bashrc</code>, all you need to do to open Jupyter Lab in your browser is a <code>jllocal</code> call on your local machine, and then <code>CTRL-C</code> when you’re done. It takes some initial set up work, but the simplicity in the end is worth it.</p>
</section>
</section>
<section id="running-on-a-compute-node" class="level1">
<h1>Running on a compute node</h1>
<p>Now let’s do the same thing, but for those of you who need to run Jupyter lab on a compute node instead of a login node. There’s a little bit more setup to think about, but in the end, <code>jllocal</code> should be all you need to type to access your Jupyter Lab session, just like on a login node.</p>
<section id="commands-1" class="level2">
<h2 class="anchored" data-anchor-id="commands-1">Commands</h2>
<p>To run Jupyter Lab on a compute node, you once again need to open 2 terminal windows. In the first window:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> ssh username@hostname</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> srun <span class="at">--mem</span><span class="op">=</span>2G <span class="at">--pty</span> bash</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> hostname</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="ex">computehostname</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> jupyter lab <span class="at">--no-browser</span> <span class="at">--port</span><span class="op">=</span>5678 <span class="at">--ip</span><span class="op">=</span><span class="va">$(</span><span class="fu">hostname</span><span class="va">)</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="ex">...</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="ex">[I</span> 10:17:14.160 LabApp] Use Control-C to stop this server and shut down all kernels <span class="er">(</span><span class="ex">twice</span> to skip confirmation<span class="kw">)</span><span class="bu">.</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="ex">[C</span> 10:17:14.160 LabApp]</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    <span class="ex">Copy/paste</span> this URL into your browser when you connect for the first time,</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    <span class="ex">to</span> login with a token:</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>        <span class="ex">http://computehostname:5678/?token=XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>If that gives you any errors, especially one that says <code>KeyError: 'runtime_dir'</code> in it, try replacing the <code>jupyter</code> line with</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> XDG_RUNTIME_DIR= jupyter lab <span class="at">--no-browser</span> <span class="at">--port</span><span class="op">=</span>5678 <span class="at">--ip</span><span class="op">=</span><span class="va">$(</span><span class="fu">hostname</span><span class="va">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>For me, the <code>XDG_RUNTIME_DIR</code> environmental variable caused some problems, and setting it to a blank value fixed it.</p>
<p>Note that the default port for Jupyter is <code>5678</code>, but to be courteous to other potential users of this cluster, you should choose an arbitrary 4-digit number (I arbitrarily chose 5678 in this case) to leave <code>8888</code> available in case someone else is playing with Jupyter. Also, <code>computehostname</code> is whatever the node spits out when you type <code>hostname</code>. It could look something like <code>node07</code>.</p>
<p>Then in the second window:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> ssh <span class="at">-CNL</span> 5678:computehostname:5678 username@hostname</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Where, once again, <code>computehostname</code> is the <code>hostname</code> of whatever compute node you got assigned when you ran your interactive compute job with the <code>srun</code> command above.</p>
<p>Then in your web browser of choice, navigate to</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode txt code-with-copy"><code class="sourceCode default"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>localhost:5678</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>in the url bar. If you haven’t already set a password, a login screen will show up asking for a token. Scroll down and you’ll see an option to set up a password:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="jupyter-setup-password.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Jupyter Password Setup</figcaption><p></p>
</figure>
</div>
<p>Enter the token (i.e.&nbsp;<code>XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</code> from above) and your desired password, and from now on you can just use your password to login.</p>
<p>Once again, just like with running on the login node, these steps can be simplified.</p>
</section>
<section id="simplfying-the-remote-side-1" class="level2">
<h2 class="anchored" data-anchor-id="simplfying-the-remote-side-1">Simplfying the remote side</h2>
<p>Having a forever Jupyter session on a compute node might not be an option for every cluster, but if it is, <code>tmux</code> or <code>screen</code>, plus bash aliases and functions once again come in handy. You can run an interactive compute job within a <code>tmux</code> session, then activate your Jupyter Lab session from within the interactive compute job, like this:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> ssh username@hostname</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> tmux</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> opens persistent shell <span class="er">session</span> <span class="ex">]</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> srun <span class="at">--mem</span><span class="op">=</span>2G <span class="at">--pty</span> bash</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> jlremote</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="ex">...</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="ex">[I</span> 10:17:14.160 LabApp] Use Control-C to stop this server and shut down all kernels <span class="er">(</span><span class="ex">twice</span> to skip confirmation<span class="kw">)</span><span class="bu">.</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="ex">[C</span> 10:17:14.160 LabApp]</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>    <span class="ex">Copy/paste</span> this URL into your browser when you connect for the first time,</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>    <span class="ex">to</span> login with a token:</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>        <span class="ex">http://localhost:8888/?token=XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>For this case, I have <code>jlremote</code> defined a little differently than for running on the login node. Before, it was an alias. Now, it’s a function (still in my remote <code>~/.bashrc</code>) that looks like this:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span><span class="fu"> jlremote</span> <span class="kw">{</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span> <span class="va">$(</span><span class="fu">hostname</span><span class="va">)</span> <span class="op">&gt;</span> ~/.jupyternode.txt</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    <span class="va">XDG_RUNTIME_DIR</span><span class="op">=</span> <span class="ex">jupyter</span> lab <span class="at">--no-browser</span> <span class="at">--port</span><span class="op">=</span>9753 <span class="at">--ip</span><span class="op">=</span><span class="va">$(</span><span class="fu">hostname</span><span class="va">)</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The main difference from before is that we’re creating a file with an arbitrary name that contains the compute node’s hostname. This will be used by the local machine to properly set up the ssh tunnel.</p>
<p>So once I have that Jupyter Lab session running, I can detach from the tmux session with <code>CTRL-b, d</code> (or <code>CTRL-a, CTRL-d</code> if you used the <code>screen</code> command), and let that process run indefinitely (days, weeks, months…), if your compute node allows it.</p>
<p>Now let’s deal with the local stuff.</p>
</section>
<section id="simplfying-the-local-side-1" class="level2">
<h2 class="anchored" data-anchor-id="simplfying-the-local-side-1">Simplfying the local side</h2>
<p>On the local side, the <code>jllocal</code> bash function also has a few changes compared to the <code>jllocal</code> function for login node Jupyter sessions. The new function, which is still in my local <code>~/.bashrc</code> file, looks like this, but with <code>USERNAME</code> and <code>HOSTNAME</code> changed to the proper values:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span><span class="fu"> jllocal</span> <span class="kw">{</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="va">port</span><span class="op">=</span>5678</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="va">remote_username</span><span class="op">=</span>USERNAME</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="va">remote_hostname</span><span class="op">=</span>HOSTNAME</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="va">node</span><span class="op">=</span><span class="va">$(</span><span class="fu">ssh</span> lindsb@rrlogin.seas.upenn.edu <span class="st">'tail -1 ~/.jupyternode.txt'</span><span class="va">)</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    <span class="va">url</span><span class="op">=</span><span class="st">"http://localhost:</span><span class="va">$port</span><span class="st">"</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span> <span class="st">"Opening </span><span class="va">$url</span><span class="st">"</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    <span class="ex">open</span> <span class="st">"</span><span class="va">$url</span><span class="st">"</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    <span class="va">cmd</span><span class="op">=</span><span class="st">"ssh -CNL "</span><span class="va">$port</span><span class="st">":"</span><span class="va">$node</span><span class="st">":"</span><span class="va">$port</span><span class="st">" </span><span class="va">$remote_username</span><span class="st">@</span><span class="va">$remote_hostname</span><span class="st">"</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span> <span class="st">"Running '</span><span class="va">$cmd</span><span class="st">'"</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    <span class="bu">eval</span> <span class="st">"</span><span class="va">$cmd</span><span class="st">"</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The main difference between this and the login node version of <code>jllocal</code> is that we grab the compute node hostname from the remote <code>~/.jupyternode.txt</code> file we created, then use that in the ssh tunnel. Otherwise, it does all the same things. When you’re done accessing your Jupyter Lab session, type <code>CTRL-C</code> and it will shut down the ssh tunnel.</p>
</section>
<section id="putting-it-all-together-1" class="level2">
<h2 class="anchored" data-anchor-id="putting-it-all-together-1">Putting it all together</h2>
<p>Just like with the login node setup, with a function in place in your remote <code>~/.bashrc</code>, a persistent remote tmux/screen session running Jupyter Lab, and a function defined in your local <code>~/.bashrc</code>, ideally a single <code>jllocal</code> call on your local machine will open your browser and connect you to your session, then <code>CTRL-C</code> when you’re done. Hopefully all this helps someone out there, and feel free to ask questions below if you get stuck.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>